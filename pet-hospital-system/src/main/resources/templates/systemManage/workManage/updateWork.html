<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>CaseStudy</title>
    <link rel="stylesheet" type="text/css" href="../css/normalize.css"/>
    <link rel="stylesheet" type="text/css" href="../css/demo.css"/>
    <link rel="stylesheet" type="text/css" href="../css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../css/tabs.css"/>
    <link rel="stylesheet" type="text/css" href="../css/tabstyles.css"/>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css"/>
    <link rel="stylesheet" id="templatecss" type="text/css" href="../css/style.css"/>
    <style>
        .module-btn p {
            width: 30%;
        }

        .codrops-header a {
            border-bottom: 1px dashed;
            padding-bottom: 0.3em;
        }

        section {
            max-width: 100%;
            min-height: 500px;
            overflow: auto;
        }

        section p {
            font-size: 1em;
        }

        .case-submenu > div {
            float: left;
            width: 18%;
            height: 200px;
            font-size: 1.2em;
            text-align: center;
            vertical-align: top;
            padding: 0.5em;
            margin: 1.5em;
            border: 1px solid #553445;
            border-radius: 1em 0 1em 0;
        }

        .case-submenu > div {
            display: flex;
            justify-content: center;
            flex-direction: column
        }

        .case-submenu > div:hover {
            padding: 0.5em;
            color: #67c2d4;
            background: rgba(103, 194, 212, .2);
            border: 1px dashed #67c2d4;
            cursor: pointer;
        }

        .case-submenu > div > div {
            display: flex;
            justify-content: center;
            font-size: 1.5rem;
            /*padding: 1rem;*/
        }


    </style>
</head>
<body class="white-bg">
<header class="codrops-header">
    <h1>更新工作流程</h1>
    <p>Update Work</p>
    <a onclick="goBack()" style="text-align: center ">返回病例选择页面</a>
</header>
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form id="form-case-update" method="POST" class="smart-green">

        <div class="form-group">
            <label class="col-sm-3 control-label">角色：</label>
            <div class="col-sm-8" style="text-align: left">
                <select id="job" class="form-control select2-multiple">
                    <option th:name="job" th:each="job:${jobs}" th:value="${job.id}"
                            th:text="${job.name}" th:selected="${job.flag}"></option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">工作流程名称：</label>
            <div class="col-sm-8">
                <input class="form-control" id="name" name="name" type="text" placeholder="请输入流程名称"
                       th:field="*{work.name}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">工作流程描述：：</label>
            <div class="col-sm-8">
<textarea class="form-control" id="description" name="description" placeholder="请输入工作流程描述"
                       th:field="*{work.description}"></textarea>


            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">工作地点：</label>
            <div class="col-sm-8">
                <input class="form-control" id="room" name="room" type="text" placeholder="请输入工作地点"
                       th:field="*{work.room}"/>
            </div>
        </div>
        <div class="col-sm-3">
            <br>
            <p>
                <video id="video1" class="videos" width="320" height="240" controls="autoplay">
                    <source id="video" class="videos" type="video/mp4" th:src="${work.video_url}"/>
                </video>
            </p>
            </br>

                <input type="file" name="videos" onchange="imgChange4(event)" id="videos" multiple="multiple"
                       style="display: none"/>
            <button type="button" onclick="delete4()" id="d4" th:style="${work.video_url != ''?'display:block;':'display:none;'}">删除视频</button>
        </div>

        <div class="row">
            <div class="col-sm-offset-5 col-sm-10">
                <button type="button" class="btn btn-lg btn-primary" onclick="submitHandler()"><i
                        class="fa fa-check"></i>保 存
                </button>&nbsp;
            </div>
        </div>
    </form>

</div>
<script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" th:inline="javascript">
    function submitHandler() {
        // var data = $("#form-disease-add").serializeArray();
        var fd = new FormData();
        var id = [[${work.id}]];
        var jobId = [[${work.job_id}]];
        fd.append("id", id);
        fd.append("name", $("#name").val());
        fd.append("description", $("#description").val());
        fd.append("room", $("#room").val());
        console.log(fd);
        var myselect = document.getElementById("job");
        var index = myselect.selectedIndex;
        var job = myselect.options[index].value;
        // data.push({"name": "kindId", "value": diseaseKind});
        fd.append("job_id", job);
        var videos = document.getElementById("videos").files;
        if (videos[0]) {
            fd.append("videos", videos[0]);
        } else {
            fd.append("videoUrlArr", document.getElementById("video1").getAttribute("src"));
        }
        fd.append("videoUrlArr", "");

        console.log(fd);
        $.ajax({
            //几个参数需要注意一下
            contentType: false,
            type: "POST",//方法类型
            processData: false,
            // dataType: "multipart/form-data",//预期服务器返回的数据类型
            url: "/api/work/update",//url
            data: fd,
            statusCode: {
                200: function (result) {
                    alert(result);
                    if(jobId == 1){
                        window.location.href = "../workManage/doctor";
                    }else if(jobId == 2){
                        window.location.href = "../workManage/assistant";
                    }else if(jobId == 3) {
                        window.location.href = "../workManage/receptionist";
                    }
                },
                400: function (result) {
                    alert(result.responseText);
                    if(jobId == 1){
                        window.location.href = "../workManage/doctor";
                    }else if(jobId == 2){
                        window.location.href = "../workManage/assistant";
                    }else if(jobId == 3) {
                        window.location.href = "../workManage/receptionist";
                    }
                }
            }
        });
    }

    goBack = function () {
        var myselect = document.getElementById("disease");
        var index = myselect.selectedIndex;
        var disease = myselect.options[index].value;
        window.location.href = "../caseManage/" + disease;
    }

    function imgChange4(e) {
        console.info(e.target.files[0]);//图片文件
        console.log(e.target.value);//这个也是文件的路径和上面的dom.value是一样的
        var reader = new FileReader();
        reader.onload = (function (file) {
            return function (e) {
                $('.videos').attr('src', this.result);
                document.getElementById("d4").setAttribute("style", "display:block;");
            };
        })(e.target.files[0]);
        reader.readAsDataURL(e.target.files[0]);
    }

    $('.videos').click(function () {
        $("#videos").click();
    });

    function delete4() {
        document.getElementById("videos").value = "";
        document.getElementById("video1").setAttribute("src", "");
        document.getElementById("d4").setAttribute("style", "display:none;");
    }

</script>
<script type="text/javascript" src="../js/modernizr.custom.js"></script>
<script type="text/javascript" src="../js/canvas-particle.js"></script>
<script type="text/javascript">
    window.onload = function () {
        var config = {
            vx: 4,
            vy: 4,
            height: 3,
            width: 3,
            count: 150,
            color: "121, 162, 185",
            stroke: "100,200,180",
            dist: 6000,
            e_dist: 20000,
            max_conn: 10
        }
        CanvasParticle(config);
    }
</script>
</body>
</html>